                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.6.8 #9946 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module render
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _sys_render_one_entity
                             12 	.globl _man_entity_forall
                             13 	.globl _cpct_getScreenPtr
                             14 	.globl _cpct_setPALColour
                             15 	.globl _cpct_setPalette
                             16 	.globl _cpct_setVideoMode
                             17 	.globl _palette
                             18 	.globl _sys_render_init
                             19 	.globl _sys_render_update
                             20 ;--------------------------------------------------------
                             21 ; special function registers
                             22 ;--------------------------------------------------------
                             23 ;--------------------------------------------------------
                             24 ; ram data
                             25 ;--------------------------------------------------------
                             26 	.area _DATA
                             27 ;--------------------------------------------------------
                             28 ; ram data
                             29 ;--------------------------------------------------------
                             30 	.area _INITIALIZED
                             31 ;--------------------------------------------------------
                             32 ; absolute external ram data
                             33 ;--------------------------------------------------------
                             34 	.area _DABS (ABS)
                             35 ;--------------------------------------------------------
                             36 ; global & static initialisations
                             37 ;--------------------------------------------------------
                             38 	.area _HOME
                             39 	.area _GSINIT
                             40 	.area _GSFINAL
                             41 	.area _GSINIT
                             42 ;--------------------------------------------------------
                             43 ; Home
                             44 ;--------------------------------------------------------
                             45 	.area _HOME
                             46 	.area _HOME
                             47 ;--------------------------------------------------------
                             48 ; code
                             49 ;--------------------------------------------------------
                             50 	.area _CODE
                             51 ;src/sys/render.c:14: void sys_render_one_entity (Entity_t* e) {
                             52 ;	---------------------------------
                             53 ; Function sys_render_one_entity
                             54 ; ---------------------------------
   0000                      55 _sys_render_one_entity::
   0000 DD E5         [15]   56 	push	ix
   0002 DD 21 00 00   [14]   57 	ld	ix,#0
   0006 DD 39         [15]   58 	add	ix,sp
   0008 F5            [11]   59 	push	af
   0009 3B            [ 6]   60 	dec	sp
                             61 ;src/sys/render.c:21: if (e->prevptr != 0) 	
   000A DD 4E 04      [19]   62 	ld	c,4 (ix)
   000D DD 46 05      [19]   63 	ld	b,5 (ix)
   0010 21 05 00      [10]   64 	ld	hl, #0x0005
   0013 09            [11]   65 	add	hl,bc
   0014 DD 75 FE      [19]   66 	ld	-2 (ix), l
   0017 DD 74 FF      [19]   67 	ld	-1 (ix), h
   001A 5E            [ 7]   68 	ld	e, (hl)
   001B 23            [ 6]   69 	inc	hl
   001C 56            [ 7]   70 	ld	d, (hl)
   001D 7A            [ 4]   71 	ld	a, d
   001E B3            [ 4]   72 	or	a,e
   001F 28 02         [12]   73 	jr	Z,00102$
                             74 ;src/sys/render.c:22: *(e->prevptr) = 0;
   0021 AF            [ 4]   75 	xor	a, a
   0022 12            [ 7]   76 	ld	(de), a
   0023                      77 00102$:
                             78 ;src/sys/render.c:26: if (!(e->type & e_type_dead)) {
   0023 0A            [ 7]   79 	ld	a, (bc)
   0024 07            [ 4]   80 	rlca
   0025 38 3D         [12]   81 	jr	C,00108$
                             82 ;src/sys/render.c:27: xPixelCoord = e->x;
   0027 69            [ 4]   83 	ld	l, c
   0028 60            [ 4]   84 	ld	h, b
   0029 23            [ 6]   85 	inc	hl
   002A 56            [ 7]   86 	ld	d, (hl)
                             87 ;src/sys/render.c:28: xByteCoord = (xPixelCoord / 2) + (xPixelCoord % 2);
   002B 5A            [ 4]   88 	ld	e, d
   002C CB 3B         [ 8]   89 	srl	e
   002E 7A            [ 4]   90 	ld	a, d
   002F E6 01         [ 7]   91 	and	a, #0x01
   0031 DD 77 FD      [19]   92 	ld	-3 (ix), a
   0034 7B            [ 4]   93 	ld	a, e
   0035 DD 86 FD      [19]   94 	add	a, -3 (ix)
                             95 ;src/sys/render.c:29: pvmem = cpct_getScreenPtr (CPCT_VMEM_START, xByteCoord, e->y);
   0038 69            [ 4]   96 	ld	l, c
   0039 60            [ 4]   97 	ld	h, b
   003A 23            [ 6]   98 	inc	hl
   003B 23            [ 6]   99 	inc	hl
   003C 56            [ 7]  100 	ld	d, (hl)
   003D C5            [11]  101 	push	bc
   003E 5F            [ 4]  102 	ld	e, a
   003F D5            [11]  103 	push	de
   0040 21 00 C0      [10]  104 	ld	hl, #0xc000
   0043 E5            [11]  105 	push	hl
   0044 CDr00r00      [17]  106 	call	_cpct_getScreenPtr
   0047 EB            [ 4]  107 	ex	de,hl
   0048 FD E1         [14]  108 	pop	iy
   004A FD 4E 04      [19]  109 	ld	c, 4 (iy)
                            110 ;src/sys/render.c:30: if( ( xPixelCoord % 2) == 0 ) {
   004D DD 7E FD      [19]  111 	ld	a, -3 (ix)
   0050 B7            [ 4]  112 	or	a, a
   0051 20 06         [12]  113 	jr	NZ,00104$
                            114 ;src/sys/render.c:31: *pvmem = e->color >> 1;	
   0053 79            [ 4]  115 	ld	a,c
   0054 CB 3F         [ 8]  116 	srl	a
   0056 12            [ 7]  117 	ld	(de), a
   0057 18 02         [12]  118 	jr	00105$
   0059                     119 00104$:
                            120 ;src/sys/render.c:33: *pvmem = e->color;
   0059 79            [ 4]  121 	ld	a, c
   005A 12            [ 7]  122 	ld	(de), a
   005B                     123 00105$:
                            124 ;src/sys/render.c:35: e->prevptr = pvmem;
   005B DD 6E FE      [19]  125 	ld	l,-2 (ix)
   005E DD 66 FF      [19]  126 	ld	h,-1 (ix)
   0061 73            [ 7]  127 	ld	(hl), e
   0062 23            [ 6]  128 	inc	hl
   0063 72            [ 7]  129 	ld	(hl), d
   0064                     130 00108$:
   0064 DD F9         [10]  131 	ld	sp, ix
   0066 DD E1         [14]  132 	pop	ix
   0068 C9            [10]  133 	ret
                            134 ;src/sys/render.c:56: void sys_render_init() {
                            135 ;	---------------------------------
                            136 ; Function sys_render_init
                            137 ; ---------------------------------
   0069                     138 _sys_render_init::
                            139 ;src/sys/render.c:57: cpct_setVideoMode(0);
   0069 2E 00         [ 7]  140 	ld	l, #0x00
   006B CDr00r00      [17]  141 	call	_cpct_setVideoMode
                            142 ;src/sys/render.c:58: cpct_setBorder(HW_BLACK);
   006E 21 10 14      [10]  143 	ld	hl, #0x1410
   0071 E5            [11]  144 	push	hl
   0072 CDr00r00      [17]  145 	call	_cpct_setPALColour
                            146 ;src/sys/render.c:59: cpct_setPalette(palette, 16);
   0075 21 10 00      [10]  147 	ld	hl, #0x0010
   0078 E5            [11]  148 	push	hl
   0079 21r81r00      [10]  149 	ld	hl, #_palette
   007C E5            [11]  150 	push	hl
   007D CDr00r00      [17]  151 	call	_cpct_setPalette
   0080 C9            [10]  152 	ret
   0081                     153 _palette:
   0081 14                  154 	.db #0x14	; 20
   0082 0B                  155 	.db #0x0b	; 11
   0083 0A                  156 	.db #0x0a	; 10
   0084 1E                  157 	.db #0x1e	; 30
   0085 0B                  158 	.db #0x0b	; 11
   0086 0B                  159 	.db #0x0b	; 11
   0087 0B                  160 	.db #0x0b	; 11
   0088 0B                  161 	.db #0x0b	; 11
   0089 0B                  162 	.db #0x0b	; 11
   008A 0B                  163 	.db #0x0b	; 11
   008B 0B                  164 	.db #0x0b	; 11
   008C 0B                  165 	.db #0x0b	; 11
   008D 0B                  166 	.db #0x0b	; 11
   008E 0B                  167 	.db #0x0b	; 11
   008F 0B                  168 	.db #0x0b	; 11
   0090 0B                  169 	.db #0x0b	; 11
                            170 ;src/sys/render.c:68: void sys_render_update() {
                            171 ;	---------------------------------
                            172 ; Function sys_render_update
                            173 ; ---------------------------------
   0091                     174 _sys_render_update::
                            175 ;src/sys/render.c:69: man_entity_forall (sys_render_one_entity);
   0091 21r00r00      [10]  176 	ld	hl, #_sys_render_one_entity
   0094 E5            [11]  177 	push	hl
   0095 CDr00r00      [17]  178 	call	_man_entity_forall
   0098 F1            [10]  179 	pop	af
   0099 C9            [10]  180 	ret
                            181 	.area _CODE
                            182 	.area _INITIALIZER
                            183 	.area _CABS (ABS)
