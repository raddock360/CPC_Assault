                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.6.8 #9946 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module render
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _sys_render_one_entity
                             12 	.globl _man_entity_forall
                             13 	.globl _cpct_getScreenPtr
                             14 	.globl _cpct_setPALColour
                             15 	.globl _cpct_setPalette
                             16 	.globl _cpct_setVideoMode
                             17 	.globl _palette
                             18 	.globl _sys_render_init
                             19 	.globl _sys_render_update
                             20 ;--------------------------------------------------------
                             21 ; special function registers
                             22 ;--------------------------------------------------------
                             23 ;--------------------------------------------------------
                             24 ; ram data
                             25 ;--------------------------------------------------------
                             26 	.area _DATA
                             27 ;--------------------------------------------------------
                             28 ; ram data
                             29 ;--------------------------------------------------------
                             30 	.area _INITIALIZED
                             31 ;--------------------------------------------------------
                             32 ; absolute external ram data
                             33 ;--------------------------------------------------------
                             34 	.area _DABS (ABS)
                             35 ;--------------------------------------------------------
                             36 ; global & static initialisations
                             37 ;--------------------------------------------------------
                             38 	.area _HOME
                             39 	.area _GSINIT
                             40 	.area _GSFINAL
                             41 	.area _GSINIT
                             42 ;--------------------------------------------------------
                             43 ; Home
                             44 ;--------------------------------------------------------
                             45 	.area _HOME
                             46 	.area _HOME
                             47 ;--------------------------------------------------------
                             48 ; code
                             49 ;--------------------------------------------------------
                             50 	.area _CODE
                             51 ;src/sys/render.c:14: void sys_render_one_entity (Entity_t* e) {
                             52 ;	---------------------------------
                             53 ; Function sys_render_one_entity
                             54 ; ---------------------------------
   0000                      55 _sys_render_one_entity::
   0000 DD E5         [15]   56 	push	ix
   0002 DD 21 00 00   [14]   57 	ld	ix,#0
   0006 DD 39         [15]   58 	add	ix,sp
   0008 F5            [11]   59 	push	af
   0009 3B            [ 6]   60 	dec	sp
                             61 ;src/sys/render.c:21: if (e->prevptr != 0) 	
   000A DD 4E 04      [19]   62 	ld	c,4 (ix)
   000D DD 46 05      [19]   63 	ld	b,5 (ix)
   0010 21 05 00      [10]   64 	ld	hl, #0x0005
   0013 09            [11]   65 	add	hl,bc
   0014 E3            [19]   66 	ex	(sp), hl
   0015 E1            [10]   67 	pop	hl
   0016 E5            [11]   68 	push	hl
   0017 5E            [ 7]   69 	ld	e, (hl)
   0018 23            [ 6]   70 	inc	hl
   0019 56            [ 7]   71 	ld	d, (hl)
   001A 7A            [ 4]   72 	ld	a, d
   001B B3            [ 4]   73 	or	a,e
   001C 28 02         [12]   74 	jr	Z,00102$
                             75 ;src/sys/render.c:22: *(e->prevptr) = 0;
   001E AF            [ 4]   76 	xor	a, a
   001F 12            [ 7]   77 	ld	(de), a
   0020                      78 00102$:
                             79 ;src/sys/render.c:26: if (!(e->type & e_type_dead)) {
   0020 0A            [ 7]   80 	ld	a, (bc)
   0021 07            [ 4]   81 	rlca
   0022 38 39         [12]   82 	jr	C,00108$
                             83 ;src/sys/render.c:27: xPixelCoord = e->x;
   0024 69            [ 4]   84 	ld	l, c
   0025 60            [ 4]   85 	ld	h, b
   0026 23            [ 6]   86 	inc	hl
   0027 56            [ 7]   87 	ld	d, (hl)
                             88 ;src/sys/render.c:28: xByteCoord = (xPixelCoord / 2) + (xPixelCoord % 2);
   0028 5A            [ 4]   89 	ld	e, d
   0029 CB 3B         [ 8]   90 	srl	e
   002B 7A            [ 4]   91 	ld	a, d
   002C E6 01         [ 7]   92 	and	a, #0x01
   002E DD 77 FF      [19]   93 	ld	-1 (ix), a
   0031 7B            [ 4]   94 	ld	a, e
   0032 DD 86 FF      [19]   95 	add	a, -1 (ix)
                             96 ;src/sys/render.c:29: pvmem = cpct_getScreenPtr (CPCT_VMEM_START, xByteCoord, e->y);
   0035 69            [ 4]   97 	ld	l, c
   0036 60            [ 4]   98 	ld	h, b
   0037 23            [ 6]   99 	inc	hl
   0038 23            [ 6]  100 	inc	hl
   0039 56            [ 7]  101 	ld	d, (hl)
   003A C5            [11]  102 	push	bc
   003B 5F            [ 4]  103 	ld	e, a
   003C D5            [11]  104 	push	de
   003D 21 00 C0      [10]  105 	ld	hl, #0xc000
   0040 E5            [11]  106 	push	hl
   0041 CDr00r00      [17]  107 	call	_cpct_getScreenPtr
   0044 EB            [ 4]  108 	ex	de,hl
   0045 FD E1         [14]  109 	pop	iy
   0047 FD 4E 04      [19]  110 	ld	c, 4 (iy)
                            111 ;src/sys/render.c:30: if( ( xPixelCoord % 2) == 0 ) {
   004A DD 7E FF      [19]  112 	ld	a, -1 (ix)
   004D B7            [ 4]  113 	or	a, a
   004E 20 06         [12]  114 	jr	NZ,00104$
                            115 ;src/sys/render.c:31: *pvmem = e->color >> 1;	
   0050 79            [ 4]  116 	ld	a,c
   0051 CB 3F         [ 8]  117 	srl	a
   0053 12            [ 7]  118 	ld	(de), a
   0054 18 02         [12]  119 	jr	00105$
   0056                     120 00104$:
                            121 ;src/sys/render.c:33: *pvmem = e->color;
   0056 79            [ 4]  122 	ld	a, c
   0057 12            [ 7]  123 	ld	(de), a
   0058                     124 00105$:
                            125 ;src/sys/render.c:35: e->prevptr = pvmem;
   0058 E1            [10]  126 	pop	hl
   0059 E5            [11]  127 	push	hl
   005A 73            [ 7]  128 	ld	(hl), e
   005B 23            [ 6]  129 	inc	hl
   005C 72            [ 7]  130 	ld	(hl), d
   005D                     131 00108$:
   005D DD F9         [10]  132 	ld	sp, ix
   005F DD E1         [14]  133 	pop	ix
   0061 C9            [10]  134 	ret
                            135 ;src/sys/render.c:56: void sys_render_init() {
                            136 ;	---------------------------------
                            137 ; Function sys_render_init
                            138 ; ---------------------------------
   0062                     139 _sys_render_init::
                            140 ;src/sys/render.c:57: cpct_setVideoMode(0);
   0062 2E 00         [ 7]  141 	ld	l, #0x00
   0064 CDr00r00      [17]  142 	call	_cpct_setVideoMode
                            143 ;src/sys/render.c:58: cpct_setBorder(HW_BLACK);
   0067 21 10 14      [10]  144 	ld	hl, #0x1410
   006A E5            [11]  145 	push	hl
   006B CDr00r00      [17]  146 	call	_cpct_setPALColour
                            147 ;src/sys/render.c:59: cpct_setPalette(palette, 16);
   006E 21 10 00      [10]  148 	ld	hl, #0x0010
   0071 E5            [11]  149 	push	hl
   0072 21r7Ar00      [10]  150 	ld	hl, #_palette
   0075 E5            [11]  151 	push	hl
   0076 CDr00r00      [17]  152 	call	_cpct_setPalette
   0079 C9            [10]  153 	ret
   007A                     154 _palette:
   007A 14                  155 	.db #0x14	; 20
   007B 0B                  156 	.db #0x0b	; 11
   007C 0A                  157 	.db #0x0a	; 10
   007D 1E                  158 	.db #0x1e	; 30
   007E 0B                  159 	.db #0x0b	; 11
   007F 0B                  160 	.db #0x0b	; 11
   0080 0B                  161 	.db #0x0b	; 11
   0081 0B                  162 	.db #0x0b	; 11
   0082 0B                  163 	.db #0x0b	; 11
   0083 0B                  164 	.db #0x0b	; 11
   0084 0B                  165 	.db #0x0b	; 11
   0085 0B                  166 	.db #0x0b	; 11
   0086 0B                  167 	.db #0x0b	; 11
   0087 0B                  168 	.db #0x0b	; 11
   0088 0B                  169 	.db #0x0b	; 11
   0089 0B                  170 	.db #0x0b	; 11
                            171 ;src/sys/render.c:68: void sys_render_update() {
                            172 ;	---------------------------------
                            173 ; Function sys_render_update
                            174 ; ---------------------------------
   008A                     175 _sys_render_update::
                            176 ;src/sys/render.c:69: man_entity_forall (sys_render_one_entity);
   008A 21r00r00      [10]  177 	ld	hl, #_sys_render_one_entity
   008D E5            [11]  178 	push	hl
   008E CDr00r00      [17]  179 	call	_man_entity_forall
   0091 F1            [10]  180 	pop	af
   0092 C9            [10]  181 	ret
                            182 	.area _CODE
                            183 	.area _INITIALIZER
                            184 	.area _CABS (ABS)
